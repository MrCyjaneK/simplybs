{
    "package": "libtor",
    "version": "tor-0.4.8.17",
    "type": "host",
    "download": {
        "kind": "git",
        "sha256": "e41649c9a34f39f1d543e064fd2b97de26d3e097",
        "url": "http://gitlab.torproject.org/tpo/core/tor.git"
    },
    "dependencies": [
        "*-android*:native/android_ndk",
        "all:native/autoconf",
        "all:native/automake",
        "all:native/m4",
        "all:native/make",
        "all:native/perl",
        "all:libevent",
        "all:openssl",
        "all:xz",
        "all:zlib",
        "all:zstd"
    ],
    "build": {
        "env": [
            "all:HOSTOVERRIDE=$HOST",
            "aarch64-apple-ios-simulator:HOSTOVERRIDE=aarch64-apple-ios",
            "all:config_opts=--host=$HOSTOVERRIDE --prefix=$PREFIX",
            "all:config_opts=$config_opts --disable-asciidoc",
            "all:config_opts=$config_opts --disable-system-torrc",
            "all:config_opts=$config_opts --disable-manpage",
            "all:config_opts=$config_opts --disable-html-manual",
            "all:config_opts=$config_opts --disable-tool-name-check",
            "*-linux-android*:config_opts=$config_opts --enable-android",
            "*-linux-android*:config_opts=$config_opts ac_cv_member_struct_tcp_info_tcpi_snd_mss=no",
            "all:config_opts=$config_opts --enable-pic",
            "all:config_opts=$config_opts --enable-static-openssl",
            "all:config_opts=$config_opts --enable-static-libevent",
            "all:config_opts=$config_opts --enable-static-zlib",
            "all:config_opts=$config_opts --enable-static-tor",
            "all:config_opts=$config_opts --disable-lzma",
            "all:config_opts=$config_opts --disable-zstd",
            "all:config_opts=$config_opts --with-openssl-dir=$PREFIX/lib",
            "all:config_opts=$config_opts --with-libevent-dir=$PREFIX/lib",
            "all:config_opts=$config_opts --with-zlib-dir=$PREFIX/lib",
            "all:config_opts=$config_opts tor_cv_library_libevent_dir=$PREFIX"
        ],
        "steps": [
            "all:./autogen.sh",
            "all:./configure $config_opts",
            "all:make -j$NUM_CORES libtor.a",
            "all:mkdir -p $STAGING_DIR$PREFIX/lib",
            "all:cp libtor.a $STAGING_DIR$PREFIX/lib/libtor.a",
            "all:mkdir -p $STAGING_DIR$PREFIX/usr/share/tor",
            "all:cp src/config/geoip $STAGING_DIR$PREFIX/usr/share/tor",
            "all:cp src/config/geoip6 $STAGING_DIR$PREFIX/usr/share/tor",
            "all:mkdir -p $STAGING_DIR$PREFIX/include/tor",
            "all:cd src && find . -name '*.h' -exec sh -c 'mkdir -p \"$STAGING_DIR$PREFIX/include/tor/$(dirname \"$1\")\" && cp \"$1\" \"$STAGING_DIR$PREFIX/include/tor/$1\"' _ {} \\;"
        ]
    }
}
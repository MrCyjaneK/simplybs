{
    "package": "protobuf",
    "version": "3.6.1",
    "type": "host",
    "download": {
        "kind": "tar.gz",
        "sha256": "b3732e471a9bb7950f090fd0457ebd2536a9ba0891b7f3785919c654fe2a2529",
        "url": "http://github.com/protocolbuffers/protobuf/releases/download/v3.6.1/protobuf-cpp-3.6.1.tar.gz"
    },
    "dependencies": [
        "*-android*:native/android_ndk",
        "all:native/autoconf",
        "all:native/automake",
        "all:native/config",
        "all:native/m4",
        "all:native/perl"
    ],
    "patches": [
        "visibility.patch"
    ],
    "build": {
        "env": [
            "all:CXXFLAGS=$CXXFLAGS -std=c++11",
            "all:config_opts=--host=$HOST --prefix=$PREFIX",
            "all:config_opts=$config_opts --disable-shared --with-protoc=$PREFIX/native/bin/protoc",
            "*-linux-gnu:$config_opts --with-pic",
            "all:SHOULD_BUILD=echo",
            "*-linux-gnu:SHOULD_BUILD=",
            "*-w64-mingw32:SHOULD_BUILD=",
            "*-apple-darwin:SHOULD_BUILD="
        ],
        "steps": [
            "all:$SHOULD_BUILD cp -f $PREFIX/native/usr/share/config/config.guess config.guess",
            "all:$SHOULD_BUILD cp -f $PREFIX/native/usr/share/config/config.sub config.sub",
            "all:$SHOULD_BUILD cp -f $PREFIX/native/usr/share/config/config.guess third_party/googletest/googletest/build-aux/config.guess",
            "all:$SHOULD_BUILD cp -f $PREFIX/native/usr/share/config/config.sub third_party/googletest/googletest/build-aux/config.sub",
            "all:$SHOULD_BUILD cp -f $PREFIX/native/usr/share/config/config.guess third_party/googletest/googlemock/build-aux/config.guess",
            "all:$SHOULD_BUILD cp -f $PREFIX/native/usr/share/config/config.sub third_party/googletest/googlemock/build-aux/config.sub",
            "all:$SHOULD_BUILD patch -p0 < $PATCH_DIR/protobuf/visibility.patch",
            "all:$SHOULD_BUILD ./configure $config_opts",
            "all:$SHOULD_BUILD make -j$NUM_CORES -C src libprotobuf.la",
            "all:$SHOULD_BUILD make -j$NUM_CORES -C src DESTDIR=$STAGING_DIR install-libLTLIBRARIES install-nobase_includeHEADERS",
            "all:$SHOULD_BUILD make -j$NUM_CORES DESTDIR=$STAGING_DIR install-pkgconfigDATA"
        ]
    }
}